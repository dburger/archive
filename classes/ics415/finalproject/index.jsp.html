<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="GNU source-highlight 1.4
by Lorenzo Bettini, bettini@gnu.org
http://w3.newnet.it/bettini
http://www.gnu.org/software/src-highlite">
<title>index.jsp</title>
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#0000EE" vlink="#551A8B" alink="#FF0000">
<pre>
<tt>
<font color=#990000>&lt;</font><font color=#990000>%</font>@ page <b><font color=#000080>import</font></b><font color=#990000>=</font><font color=#FF0000>"java.net.URLEncoder"</font> <font color=#990000>%</font><font color=#990000>&gt;</font>
<font color=#990000>&lt;</font><font color=#990000>%</font>@ page <b><font color=#000080>import</font></b><font color=#990000>=</font><font color=#FF0000>"java.sql.DriverManager"</font> <font color=#990000>%</font><font color=#990000>&gt;</font>
<font color=#990000>&lt;</font><font color=#990000>%</font>@ page <b><font color=#000080>import</font></b><font color=#990000>=</font><font color=#FF0000>"java.sql.Connection"</font> <font color=#990000>%</font><font color=#990000>&gt;</font>
<font color=#990000>&lt;</font><font color=#990000>%</font>@ page <b><font color=#000080>import</font></b><font color=#990000>=</font><font color=#FF0000>"java.sql.ResultSet"</font> <font color=#990000>%</font><font color=#990000>&gt;</font>
<font color=#990000>&lt;</font><font color=#990000>%</font>@ page <b><font color=#000080>import</font></b><font color=#990000>=</font><font color=#FF0000>"java.sql.Statement"</font> <font color=#990000>%</font><font color=#990000>&gt;</font>
<font color=#990000>&lt;</font><font color=#990000>%</font>@ page <b><font color=#000080>import</font></b><font color=#990000>=</font><font color=#FF0000>"java.sql.SQLException"</font> <font color=#990000>%</font><font color=#990000>&gt;</font>
<font color=#990000>&lt;</font><font color=#990000>%</font>@ page <b><font color=#000080>import</font></b><font color=#990000>=</font><font color=#FF0000>"java.util.ArrayList"</font> <font color=#990000>%</font><font color=#990000>&gt;</font>

<font color=#990000>&lt;</font><font color=#990000>%</font>@ page errorPage<font color=#990000>=</font><font color=#FF0000>"bookstoreError.jsp"</font> <font color=#990000>%</font><font color=#990000>&gt;</font>

<font color=#990000>&lt;</font><font color=#990000>%</font>@ page session<font color=#990000>=</font><font color=#FF0000>"true"</font> <font color=#990000>%</font><font color=#990000>&gt;</font>

<font color=#990000>&lt;</font><font color=#990000>%</font><font color=#990000>!</font> Connection conn<font color=#990000>;</font> <font color=#990000>%</font><font color=#990000>&gt;</font>
<font color=#990000>&lt;</font><font color=#990000>%</font><font color=#990000>!</font> ArrayList shoppingCart<font color=#990000>;</font> <font color=#990000>%</font><font color=#990000>&gt;</font>
<font color=#990000>&lt;</font><font color=#990000>%</font><font color=#990000>!</font> <b><font color=#0000FF>final</font></b> <font color=#009900>int</font> MAX_RECORDS <font color=#990000>=</font> <font color=#993399>10</font><font color=#990000>;</font> <font color=#990000>%</font><font color=#990000>&gt;</font>
<font color=#990000>&lt;</font><font color=#990000>%</font>
  conn <font color=#990000>=</font> <font color=#990000>(</font>Connection<font color=#990000>)</font>application<font color=#990000>.</font><b><font color=#000000>getAttribute</font></b><font color=#990000>(</font><font color=#FF0000>"connection"</font><font color=#990000>)</font><font color=#990000>;</font>
  <b><font color=#0000FF>if</font></b> <font color=#990000>(</font>conn<font color=#990000>=</font><font color=#990000>=</font><b><font color=#0000FF>null</font></b><font color=#990000>)</font> <font color=#FF0000>{</font>
    <b><font color=#0000FF>try</font></b> <font color=#FF0000>{</font>
      DriverManager<font color=#990000>.</font><b><font color=#000000>registerDriver</font></b><font color=#990000>(</font><b><font color=#0000FF>new</font></b> org<font color=#990000>.</font>gjt<font color=#990000>.</font>mm<font color=#990000>.</font>mysql<font color=#990000>.</font><b><font color=#000000>Driver</font></b><font color=#990000>(</font><font color=#990000>)</font><font color=#990000>)</font><font color=#990000>;</font>
      conn <font color=#990000>=</font> DriverManager<font color=#990000>.</font><b><font color=#000000>getConnection</font></b><font color=#990000>(</font><font color=#FF0000>"jdbc:mysql:///bookstore"</font><font color=#990000>)</font><font color=#990000>;</font>
      application<font color=#990000>.</font><b><font color=#000000>setAttribute</font></b><font color=#990000>(</font><font color=#FF0000>"connection"</font><font color=#990000>,</font>conn<font color=#990000>)</font><font color=#990000>;</font>
    <font color=#FF0000>}</font> <b><font color=#0000FF>catch</font></b> <font color=#990000>(</font>SQLException e<font color=#990000>)</font> <font color=#FF0000>{</font>
      <b><font color=#0000FF>throw</font></b> <b><font color=#0000FF>new</font></b> <b><font color=#000000>ServletException</font></b><font color=#990000>(</font><font color=#FF0000>"Unable to create a connection to the database."</font><font color=#990000>,</font>e<font color=#990000>)</font><font color=#990000>;</font>
    <font color=#FF0000>}</font>
  <font color=#FF0000>}</font>

  shoppingCart <font color=#990000>=</font> <font color=#990000>(</font>ArrayList<font color=#990000>)</font>session<font color=#990000>.</font><b><font color=#000000>getAttribute</font></b><font color=#990000>(</font><font color=#FF0000>"shoppingCart"</font><font color=#990000>)</font><font color=#990000>;</font>
  <b><font color=#0000FF>if</font></b> <font color=#990000>(</font>shoppingCart<font color=#990000>=</font><font color=#990000>=</font><b><font color=#0000FF>null</font></b><font color=#990000>)</font> <font color=#FF0000>{</font>
    shoppingCart <font color=#990000>=</font> <b><font color=#0000FF>new</font></b> <b><font color=#000000>ArrayList</font></b><font color=#990000>(</font><font color=#990000>)</font><font color=#990000>;</font>
    session<font color=#990000>.</font><b><font color=#000000>setAttribute</font></b><font color=#990000>(</font><font color=#FF0000>"shoppingCart"</font><font color=#990000>,</font>shoppingCart<font color=#990000>)</font><font color=#990000>;</font>
  <font color=#FF0000>}</font>
  
  <b><font color=#0000FF>if</font></b> <font color=#990000>(</font>request<font color=#990000>.</font><b><font color=#000000>getParameter</font></b><font color=#990000>(</font><font color=#FF0000>"addToCart"</font><font color=#990000>)</font><font color=#990000>!</font><font color=#990000>=</font><b><font color=#0000FF>null</font></b><font color=#990000>)</font> <font color=#FF0000>{</font>
    String itemString<font color=#990000>,</font> isbn<font color=#990000>,</font> newISBN <font color=#990000>=</font> request<font color=#990000>.</font><b><font color=#000000>getParameter</font></b><font color=#990000>(</font><font color=#FF0000>"addToCart"</font><font color=#990000>)</font><font color=#990000>;</font>
    <font color=#009900>int</font> commaPos<font color=#990000>,</font> quantity<font color=#990000>;</font>
    <font color=#009900>int</font> i<font color=#990000>;</font>
    <b><font color=#0000FF>for</font></b> <font color=#990000>(</font>i<font color=#990000>=</font><font color=#993399>0</font><font color=#990000>;</font>i<font color=#990000>&lt;</font>shoppingCart<font color=#990000>.</font><b><font color=#000000>size</font></b><font color=#990000>(</font><font color=#990000>)</font><font color=#990000>;</font>i<font color=#990000>+</font><font color=#990000>+</font><font color=#990000>)</font> <font color=#FF0000>{</font>
      itemString <font color=#990000>=</font> <font color=#990000>(</font>String<font color=#990000>)</font>shoppingCart<font color=#990000>.</font><b><font color=#000000>get</font></b><font color=#990000>(</font>i<font color=#990000>)</font><font color=#990000>;</font>
      commaPos <font color=#990000>=</font> itemString<font color=#990000>.</font><b><font color=#000000>indexOf</font></b><font color=#990000>(</font><font color=#FF0000>','</font><font color=#990000>)</font><font color=#990000>;</font>
      isbn <font color=#990000>=</font> itemString<font color=#990000>.</font><b><font color=#000000>substring</font></b><font color=#990000>(</font><font color=#993399>0</font><font color=#990000>,</font>commaPos<font color=#990000>)</font><font color=#990000>;</font>
      quantity <font color=#990000>=</font> Integer<font color=#990000>.</font><b><font color=#000000>parseInt</font></b><font color=#990000>(</font>itemString<font color=#990000>.</font><b><font color=#000000>substring</font></b><font color=#990000>(</font>commaPos<font color=#990000>+</font><font color=#993399>1</font><font color=#990000>)</font><font color=#990000>)</font><font color=#990000>;</font>
      <b><font color=#0000FF>if</font></b> <font color=#990000>(</font>isbn<font color=#990000>.</font><b><font color=#000000>equals</font></b><font color=#990000>(</font>newISBN<font color=#990000>)</font><font color=#990000>)</font> <font color=#FF0000>{</font>
        quantity<font color=#990000>+</font><font color=#990000>+</font><font color=#990000>;</font>
        shoppingCart<font color=#990000>.</font><b><font color=#000000>set</font></b><font color=#990000>(</font>i<font color=#990000>,</font>isbn <font color=#990000>+</font> <font color=#FF0000>","</font> <font color=#990000>+</font> quantity<font color=#990000>)</font><font color=#990000>;</font>
        <b><font color=#0000FF>break</font></b><font color=#990000>;</font>
      <font color=#FF0000>}</font>
    <font color=#FF0000>}</font>
    <b><font color=#0000FF>if</font></b> <font color=#990000>(</font>i<font color=#990000>=</font><font color=#990000>=</font>shoppingCart<font color=#990000>.</font><b><font color=#000000>size</font></b><font color=#990000>(</font><font color=#990000>)</font><font color=#990000>)</font>
      shoppingCart<font color=#990000>.</font><b><font color=#000000>add</font></b><font color=#990000>(</font>newISBN <font color=#990000>+</font> <font color=#FF0000>",1"</font><font color=#990000>)</font><font color=#990000>;</font>
  <font color=#FF0000>}</font> <b><font color=#0000FF>else</font></b> <b><font color=#0000FF>if</font></b> <font color=#990000>(</font>request<font color=#990000>.</font><b><font color=#000000>getParameter</font></b><font color=#990000>(</font><font color=#FF0000>"clearCart"</font><font color=#990000>)</font><font color=#990000>!</font><font color=#990000>=</font><b><font color=#0000FF>null</font></b><font color=#990000>)</font> <font color=#FF0000>{</font>
    shoppingCart <font color=#990000>=</font> <b><font color=#0000FF>new</font></b> <b><font color=#000000>ArrayList</font></b><font color=#990000>(</font><font color=#990000>)</font><font color=#990000>;</font>
    session<font color=#990000>.</font><b><font color=#000000>setAttribute</font></b><font color=#990000>(</font><font color=#FF0000>"shoppingCart"</font><font color=#990000>,</font>shoppingCart<font color=#990000>)</font><font color=#990000>;</font>
  <font color=#FF0000>}</font> <b><font color=#0000FF>else</font></b> <b><font color=#0000FF>if</font></b> <font color=#990000>(</font>request<font color=#990000>.</font><b><font color=#000000>getParameter</font></b><font color=#990000>(</font><font color=#FF0000>"login"</font><font color=#990000>)</font><font color=#990000>!</font><font color=#990000>=</font><b><font color=#0000FF>null</font></b><font color=#990000>)</font> <font color=#FF0000>{</font>
    Statement st <font color=#990000>=</font> conn<font color=#990000>.</font><b><font color=#000000>createStatement</font></b><font color=#990000>(</font><font color=#990000>)</font><font color=#990000>;</font>
    ResultSet rs <font color=#990000>=</font> st<font color=#990000>.</font><b><font color=#000000>executeQuery</font></b><font color=#990000>(</font><font color=#FF0000>"select * from user where user_id='"</font> <font color=#990000>+</font>
                                   request<font color=#990000>.</font><b><font color=#000000>getParameter</font></b><font color=#990000>(</font><font color=#FF0000>"user_id"</font><font color=#990000>)</font> <font color=#990000>+</font>
                                   <font color=#FF0000>"' and password='"</font> <font color=#990000>+</font>
                                   request<font color=#990000>.</font><b><font color=#000000>getParameter</font></b><font color=#990000>(</font><font color=#FF0000>"password"</font><font color=#990000>)</font> <font color=#990000>+</font> <font color=#FF0000>"'"</font><font color=#990000>)</font><font color=#990000>;</font>
    <b><font color=#0000FF>if</font></b> <font color=#990000>(</font>rs<font color=#990000>.</font><b><font color=#000000>next</font></b><font color=#990000>(</font><font color=#990000>)</font><font color=#990000>)</font>
      session<font color=#990000>.</font><b><font color=#000000>setAttribute</font></b><font color=#990000>(</font><font color=#FF0000>"user_id"</font><font color=#990000>,</font>request<font color=#990000>.</font><b><font color=#000000>getParameter</font></b><font color=#990000>(</font><font color=#FF0000>"user_id"</font><font color=#990000>)</font><font color=#990000>)</font><font color=#990000>;</font>
  <font color=#FF0000>}</font> <b><font color=#0000FF>else</font></b> <b><font color=#0000FF>if</font></b> <font color=#990000>(</font>request<font color=#990000>.</font><b><font color=#000000>getParameter</font></b><font color=#990000>(</font><font color=#FF0000>"logout"</font><font color=#990000>)</font><font color=#990000>!</font><font color=#990000>=</font><b><font color=#0000FF>null</font></b><font color=#990000>)</font> <font color=#FF0000>{</font>
    session<font color=#990000>.</font><b><font color=#000000>removeAttribute</font></b><font color=#990000>(</font><font color=#FF0000>"user_id"</font><font color=#990000>)</font><font color=#990000>;</font>
    session<font color=#990000>.</font><b><font color=#000000>setAttribute</font></b><font color=#990000>(</font><font color=#FF0000>"user_id"</font><font color=#990000>,</font><b><font color=#0000FF>null</font></b><font color=#990000>)</font><font color=#990000>;</font>  <i><font color=#9A1900>// weird behavior, needed to do both    </font></i>
  <font color=#FF0000>}</font>
<font color=#990000>%</font><font color=#990000>&gt;</font>
<font color=#990000>&lt;</font>html<font color=#990000>&gt;</font>
<font color=#990000>&lt;</font>head<font color=#990000>&gt;</font>
<font color=#990000>&lt;</font>title<font color=#990000>&gt;</font>rdbwbooks<font color=#990000>.</font>com<font color=#990000>&lt;</font><font color=#990000>/</font>title<font color=#990000>&gt;</font>
<font color=#990000>&lt;</font>style type <font color=#990000>=</font> <font color=#FF0000>"text/css"</font><font color=#990000>&gt;</font>
  <font color=#990000>&lt;</font><font color=#990000>!</font><font color=#990000>-</font><font color=#990000>-</font>
  @<b><font color=#000080>import</font></b> <b><font color=#000000>url</font></b><font color=#990000>(</font>stylesheet<font color=#990000>/</font>bookstore<font color=#990000>.</font>css<font color=#990000>)</font><font color=#990000>;</font>
  <font color=#990000>-</font><font color=#990000>-</font><font color=#990000>&gt;</font>
<font color=#990000>&lt;</font><font color=#990000>/</font>style<font color=#990000>&gt;</font>
<font color=#990000>&lt;</font>script language<font color=#990000>=</font><font color=#FF0000>"javascript"</font><font color=#990000>&gt;</font>
<font color=#990000>&lt;</font><font color=#990000>!</font><font color=#990000>-</font><font color=#990000>-</font>

function <b><font color=#000000>validateLogin</font></b><font color=#990000>(</font><font color=#990000>)</font> <font color=#FF0000>{</font>
  var errorString <font color=#990000>=</font> <font color=#FF0000>""</font><font color=#990000>;</font>
  var theForm <font color=#990000>=</font> document<font color=#990000>.</font>forms<font color=#990000>[</font><font color=#FF0000>'login'</font><font color=#990000>]</font><font color=#990000>;</font>
  <b><font color=#0000FF>if</font></b> <font color=#990000>(</font>theForm<font color=#990000>.</font>user_id<font color=#990000>.</font>value<font color=#990000>=</font><font color=#990000>=</font><font color=#FF0000>""</font><font color=#990000>)</font>
    errorString <font color=#990000>+</font><font color=#990000>=</font> <font color=#FF0000>"Please enter a user id."</font><font color=#990000>;</font>
  <b><font color=#0000FF>if</font></b> <font color=#990000>(</font>theForm<font color=#990000>.</font>password<font color=#990000>.</font>value<font color=#990000>=</font><font color=#990000>=</font><font color=#FF0000>""</font><font color=#990000>)</font>
    errorString <font color=#990000>+</font><font color=#990000>=</font> <font color=#FF0000>"\nPlease enter a password."</font><font color=#990000>;</font>
  <b><font color=#0000FF>if</font></b> <font color=#990000>(</font>errorString<font color=#990000>.</font>length<font color=#990000>)</font> <font color=#FF0000>{</font>
    <i><font color=#9A1900>// go reverse so first has focus</font></i>
    <b><font color=#0000FF>if</font></b> <font color=#990000>(</font>theForm<font color=#990000>.</font>password<font color=#990000>.</font>value<font color=#990000>=</font><font color=#990000>=</font><font color=#FF0000>""</font><font color=#990000>)</font> theForm<font color=#990000>.</font>password<font color=#990000>.</font><b><font color=#000000>focus</font></b><font color=#990000>(</font><font color=#990000>)</font><font color=#990000>;</font>
    <b><font color=#0000FF>if</font></b> <font color=#990000>(</font>theForm<font color=#990000>.</font>user_id<font color=#990000>.</font>value<font color=#990000>=</font><font color=#990000>=</font><font color=#FF0000>""</font><font color=#990000>)</font> theForm<font color=#990000>.</font>user_id<font color=#990000>.</font><b><font color=#000000>focus</font></b><font color=#990000>(</font><font color=#990000>)</font><font color=#990000>;</font>
    <b><font color=#000000>alert</font></b><font color=#990000>(</font>errorString<font color=#990000>)</font><font color=#990000>;</font>
    <b><font color=#0000FF>return</font></b> false<font color=#990000>;</font>
  <font color=#FF0000>}</font> <b><font color=#0000FF>else</font></b>
    <b><font color=#0000FF>return</font></b> true<font color=#990000>;</font>
<font color=#FF0000>}</font>

function <b><font color=#000000>validateSearch</font></b><font color=#990000>(</font><font color=#990000>)</font> <font color=#FF0000>{</font>
  var errorString <font color=#990000>=</font> <font color=#FF0000>""</font><font color=#990000>;</font>
  var theForm <font color=#990000>=</font> document<font color=#990000>.</font>forms<font color=#990000>[</font><font color=#FF0000>'search'</font><font color=#990000>]</font><font color=#990000>;</font>
  <b><font color=#0000FF>if</font></b> <font color=#990000>(</font>theForm<font color=#990000>.</font>searchFor<font color=#990000>.</font>value<font color=#990000>=</font><font color=#990000>=</font><font color=#FF0000>""</font><font color=#990000>)</font>
    errorString<font color=#990000>+</font><font color=#990000>=</font><font color=#FF0000>"Please enter text to search for."</font><font color=#990000>;</font>
  <b><font color=#0000FF>if</font></b> <font color=#990000>(</font>errorString<font color=#990000>.</font>length<font color=#990000>)</font> <font color=#FF0000>{</font>
    theForm<font color=#990000>.</font>searchFor<font color=#990000>.</font><b><font color=#000000>focus</font></b><font color=#990000>(</font><font color=#990000>)</font><font color=#990000>;</font>
    <b><font color=#000000>alert</font></b><font color=#990000>(</font>errorString<font color=#990000>)</font><font color=#990000>;</font>
    <b><font color=#0000FF>return</font></b> false<font color=#990000>;</font>
  <font color=#FF0000>}</font> <b><font color=#0000FF>else</font></b>
    <b><font color=#0000FF>return</font></b> true<font color=#990000>;</font>
<font color=#FF0000>}</font>

<i><font color=#9A1900>//--&gt;</font></i>
<font color=#990000>&lt;</font><font color=#990000>/</font>script<font color=#990000>&gt;</font>
<font color=#990000>&lt;</font><font color=#990000>/</font>head<font color=#990000>&gt;</font>
<font color=#990000>&lt;</font>body<font color=#990000>&gt;</font>

<font color=#990000>&lt;</font>form name<font color=#990000>=</font><font color=#FF0000>"login"</font> method<font color=#990000>=</font><font color=#FF0000>"post"</font> action<font color=#990000>=</font><font color=#FF0000>"index.jsp"</font> onsubmit<font color=#990000>=</font><font color=#FF0000>"return validateLogin();"</font><font color=#990000>&gt;</font>
<font color=#990000>&lt;</font><font color=#990000>!</font><font color=#990000>-</font><font color=#990000>-</font> <b><font color=#0000FF>this</font></b> table <b><font color=#0000FF>extends</font></b> across the top of the page with logo left<font color=#990000>,</font> login right <font color=#990000>-</font><font color=#990000>-</font><font color=#990000>&gt;</font>
<font color=#990000>&lt;</font>table width<font color=#990000>=</font><font color=#FF0000>"100%"</font><font color=#990000>&gt;</font>
  <font color=#990000>&lt;</font>tr<font color=#990000>&gt;</font>
    <font color=#990000>&lt;</font>td align<font color=#990000>=</font><font color=#FF0000>"left"</font><font color=#990000>&gt;</font><font color=#990000>&lt;</font>img src<font color=#990000>=</font><font color=#FF0000>"images/logo_small.gif"</font> width<font color=#990000>=</font><font color=#FF0000>"148"</font> height<font color=#990000>=</font><font color=#FF0000>"27"</font>
                      alt<font color=#990000>=</font><font color=#FF0000>"rdbwbooks.com"</font><font color=#990000>&gt;</font><font color=#990000>&lt;</font><font color=#990000>/</font>td<font color=#990000>&gt;</font>
    <font color=#990000>&lt;</font>td align<font color=#990000>=</font><font color=#FF0000>"right"</font><font color=#990000>&gt;</font>
      <font color=#990000>&lt;</font><font color=#990000>%</font>
        <i><font color=#9A1900>// this is right side top</font></i>
        String itemString<font color=#990000>;</font>
        <font color=#009900>int</font> commaPos<font color=#990000>,</font> totalQuantity <font color=#990000>=</font> <font color=#993399>0</font><font color=#990000>;</font>
        <b><font color=#0000FF>for</font></b> <font color=#990000>(</font><font color=#009900>int</font> i<font color=#990000>=</font><font color=#993399>0</font><font color=#990000>;</font>i<font color=#990000>&lt;</font>shoppingCart<font color=#990000>.</font><b><font color=#000000>size</font></b><font color=#990000>(</font><font color=#990000>)</font><font color=#990000>;</font>i<font color=#990000>+</font><font color=#990000>+</font><font color=#990000>)</font> <font color=#FF0000>{</font>
          itemString <font color=#990000>=</font> <font color=#990000>(</font>String<font color=#990000>)</font>shoppingCart<font color=#990000>.</font><b><font color=#000000>get</font></b><font color=#990000>(</font>i<font color=#990000>)</font><font color=#990000>;</font>
          commaPos <font color=#990000>=</font> itemString<font color=#990000>.</font><b><font color=#000000>indexOf</font></b><font color=#990000>(</font><font color=#FF0000>','</font><font color=#990000>)</font><font color=#990000>;</font>
          totalQuantity <font color=#990000>+</font><font color=#990000>=</font> Integer<font color=#990000>.</font><b><font color=#000000>parseInt</font></b><font color=#990000>(</font>itemString<font color=#990000>.</font><b><font color=#000000>substring</font></b><font color=#990000>(</font>commaPos<font color=#990000>+</font><font color=#993399>1</font><font color=#990000>)</font><font color=#990000>)</font><font color=#990000>;</font>
        <font color=#FF0000>}</font>
        out<font color=#990000>.</font><b><font color=#000000>println</font></b><font color=#990000>(</font><font color=#FF0000>"["</font> <font color=#990000>+</font> totalQuantity <font color=#990000>+</font>
                    <font color=#FF0000>" items in &lt;a href='viewcart.jsp'&gt;shopping cart&lt;/a&gt;]  "</font> <font color=#990000>+</font>
                    <font color=#FF0000>"[&lt;a href='index.jsp?clearCart='&gt;clear cart&lt;/a&gt;]"</font><font color=#990000>)</font><font color=#990000>;</font>
      <font color=#990000>%</font><font color=#990000>&gt;</font>
    <font color=#990000>&lt;</font><font color=#990000>/</font>td<font color=#990000>&gt;</font>
  <font color=#990000>&lt;</font><font color=#990000>/</font>tr<font color=#990000>&gt;</font>
<font color=#990000>&lt;</font><font color=#990000>/</font>table<font color=#990000>&gt;</font>

<font color=#990000>&lt;</font><font color=#990000>!</font><font color=#990000>-</font><font color=#990000>-</font> <b><font color=#0000FF>this</font></b> is the <font color=#FF0000>"red bar"</font> table at the top <font color=#990000>-</font><font color=#990000>-</font><font color=#990000>&gt;</font>
<font color=#990000>&lt;</font>table width<font color=#990000>=</font><font color=#FF0000>"100%"</font> cellpadding<font color=#990000>=</font><font color=#FF0000>"5"</font> cellspacing<font color=#990000>=</font><font color=#FF0000>"0"</font><font color=#990000>&gt;</font>
  <font color=#990000>&lt;</font>tr <b><font color=#0000FF>class</font></b><font color=#990000>=</font><font color=#FF0000>"mainBar"</font><font color=#990000>&gt;</font>
    <font color=#990000>&lt;</font>td<font color=#990000>&gt;</font>
      <font color=#990000>&lt;</font>a href<font color=#990000>=</font><font color=#FF0000>"index.jsp"</font><font color=#990000>&gt;</font><font color=#990000>&lt;</font>img src<font color=#990000>=</font><font color=#FF0000>"images/home.gif"</font> width<font color=#990000>=</font><font color=#FF0000>'83'</font> height<font color=#990000>=</font><font color=#FF0000>'28'</font> border<font color=#990000>=</font><font color=#FF0000>"0"</font>
                           alt<font color=#990000>=</font><font color=#FF0000>"home"</font><font color=#990000>/</font><font color=#990000>&gt;</font><font color=#990000>&lt;</font><font color=#990000>/</font>a<font color=#990000>&gt;</font>
      <font color=#990000>&lt;</font>a href<font color=#990000>=</font><font color=#FF0000>"viewcart.jsp"</font><font color=#990000>&gt;</font><font color=#990000>&lt;</font>img src<font color=#990000>=</font><font color=#FF0000>"images/viewcart.gif"</font> width<font color=#990000>=</font><font color=#FF0000>'153'</font> height<font color=#990000>=</font><font color=#FF0000>'28'</font>
                              border<font color=#990000>=</font><font color=#FF0000>"0"</font> alt<font color=#990000>=</font><font color=#FF0000>"view cart"</font><font color=#990000>/</font><font color=#990000>&gt;</font><font color=#990000>&lt;</font><font color=#990000>/</font>a<font color=#990000>&gt;</font>
      <font color=#990000>&lt;</font><font color=#990000>%</font>
        <b><font color=#0000FF>if</font></b> <font color=#990000>(</font>session<font color=#990000>.</font><b><font color=#000000>getAttribute</font></b><font color=#990000>(</font><font color=#FF0000>"user_id"</font><font color=#990000>)</font><font color=#990000>!</font><font color=#990000>=</font><b><font color=#0000FF>null</font></b><font color=#990000>)</font>
          out<font color=#990000>.</font><b><font color=#000000>println</font></b><font color=#990000>(</font><font color=#FF0000>"&lt;a href='userinfo.jsp'&gt;&lt;img src='images/userinfo.gif' "</font> <font color=#990000>+</font>
                      <font color=#FF0000>"width='105' height='28' border='0' alt='user information'/&gt;&lt;/a&gt;"</font><font color=#990000>)</font><font color=#990000>;</font>
        <b><font color=#0000FF>else</font></b>
         out<font color=#990000>.</font><b><font color=#000000>println</font></b><font color=#990000>(</font><font color=#FF0000>"&lt;a href='userinfo.jsp'&gt;&lt;img src='images/signup.gif' width='105' "</font> <font color=#990000>+</font>
                     <font color=#FF0000>"height='28' border='0' alt='sign up'/&gt;&lt;/a&gt;"</font><font color=#990000>)</font><font color=#990000>;</font>
      <font color=#990000>%</font><font color=#990000>&gt;</font>
      
    <font color=#990000>&lt;</font><font color=#990000>/</font>td<font color=#990000>&gt;</font>
    <font color=#990000>&lt;</font>td align<font color=#990000>=</font><font color=#FF0000>"right"</font> nowrap<font color=#990000>&gt;</font>
      <font color=#990000>&lt;</font><font color=#990000>!</font><font color=#990000>-</font><font color=#990000>-</font> code here to determine <b><font color=#0000FF>if</font></b> they are already logged in
        <font color=#990000>-</font><font color=#990000>-</font> <b><font color=#0000FF>if</font></b> yes<font color=#990000>,</font> then don<font color=#FF0000>'t display the login stuff, display
        -- you are logged in as blah...                         --&gt;
      &lt;%
        if (session.getAttribute("user_id")==null) {
          out.println("User ID:");
          out.println("&lt;input type='</font>text<font color=#FF0000>' name='</font>user_id<font color=#FF0000>' size='</font><font color=#993399>10</font><font color=#FF0000>'&gt;");
          out.println("Password:");
          out.println("&lt;input type='</font>password<font color=#FF0000>' name='</font>password<font color=#FF0000>' size='</font><font color=#993399>10</font><font color=#FF0000>'&gt;");
          out.println("&lt;input type='</font>submit<font color=#FF0000>' name='</font>login<font color=#FF0000>' value='</font>login<font color=#FF0000>'/&gt;");
        } else {
          out.println("Logged in as: &lt;a href='</font>userinfo<font color=#990000>.</font>jsp<font color=#FF0000>'&gt;" +
                      session.getAttribute("user_id") + "&lt;/a&gt;");
          out.println("&lt;input type='</font>submit<font color=#FF0000>' name='</font>logout<font color=#FF0000>' value='</font>logout<font color=#FF0000>'/&gt;");
        }
      %&gt;
    &lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
&lt;/form&gt;

&lt;!-- main table that has a right column for search/category and the main left column --&gt;
&lt;table width="100%"&gt;
  &lt;tr&gt;

    &lt;!-- this is the main left column --&gt;
    &lt;td valign="top"&gt;

      &lt;%
      
        String queryString = "SELECT distinct book.isbn, book.title, book.author_first," +
                             " book.author_last, book.publisher, book.price " +
                             "FROM book, book_category " +
                             "WHERE book.isbn=book_category.isbn";
        int firstRecord = 0;
        
        // NOTE:  login and addToCart was handled above so that the login information and
        // number of items in the cart would be displayed correctly !!!
        if (request.getParameter("search")!=null) { // coming from search form
          queryString += " and book." + request.getParameter("searchWhat");
          queryString += " like '</font><font color=#990000>%</font><font color=#FF0000>" + request.getParameter("</font>searchFor<font color=#FF0000>") + "</font><font color=#990000>%</font><font color=#FF0000>'";                      
          if (!request.getParameter("searchCategory").equals("all")) {
            queryString += " and book_category.category='</font><font color=#FF0000>" +
              request.getParameter("</font>searchCategory<font color=#FF0000>") + "</font><font color=#FF0000>'";
          }
          // out.println(queryString); // for debugging
        } else if (request.getParameter("category")!=null) { // from a category click
          queryString += " and book_category.category='</font><font color=#FF0000>" +
            request.getParameter("</font>category<font color=#FF0000>") + "</font><font color=#FF0000>'";
        } else if (request.getParameter("lastQuery")!=null) { // moving through set
          queryString = request.getParameter("lastQuery");
          firstRecord = Integer.parseInt(request.getParameter("firstRecord"));
        } else if (request.getParameter("advancedSearch")!=null) {  // advanced search
          queryString = request.getParameter("advancedSearch");
        } else { // coming straight to this page
          // could do something here to decide what to show user on a first visit page
        }
        
        String lastQuery = queryString;        
        queryString += " limit " + firstRecord + "," + (MAX_RECORDS*2); // *2 for leftover
        
        //out.println(queryString);  // used for debugging
                 
        // code here to generate the list of books
        int recordCount = 0;
        try {
          Statement st = conn.createStatement();
          ResultSet rs = st.executeQuery(queryString);
          while (recordCount &lt; MAX_RECORDS &amp;&amp; rs.next()) {
            out.println("&lt;table class='</font>bookList<font color=#FF0000>'&gt;&lt;tr&gt;");
            // hard coded book image for now, fancy implementation has book images
            out.println("&lt;td class='</font>coverImageCell<font color=#FF0000>'&gt;&lt;img src='</font>images<font color=#990000>/</font>unavailable<font color=#990000>.</font>jpg<font color=#FF0000>'/&gt;" +
                        "&lt;/td&gt;");
            out.println("&lt;td class='</font>bookInfoCell<font color=#FF0000>'&gt;");
            out.println("&lt;span class='</font>title<font color=#FF0000>'&gt;" + rs.getString("title") + "&lt;/span&gt;&lt;br/&gt;");
            out.println("&lt;span class='</font>author<font color=#FF0000>'&gt;" + rs.getString("author_first") + " " +
                        rs.getString("author_last") + "&lt;/span&gt;&lt;br/&gt;");
            out.println("&lt;span class='</font>publisher<font color=#FF0000>'&gt;" + rs.getString("publisher") +
                        "&lt;/span&gt;&lt;br/&gt;");
            out.println("ISBN: &lt;span class='</font>isbn<font color=#FF0000>'&gt;" + rs.getString("isbn") +
                        "&lt;/span&gt;&lt;br/&gt;");
            out.println("Price: &lt;span class='</font>price<font color=#FF0000>'&gt;" + rs.getDouble("price") +
                        "&lt;/span&gt;&lt;br/&gt;");
            out.println("&lt;a href='</font>index<font color=#990000>.</font>jsp<font color=#990000>?</font>addToCart<font color=#990000>=</font><font color=#FF0000>" + rs.getString("</font>isbn<font color=#FF0000>") +
                        "</font><font color=#990000>&amp;</font>lastQuery<font color=#990000>=</font><font color=#FF0000>" + URLEncoder.encode(lastQuery) + "</font><font color=#990000>&amp;</font>firstRecord<font color=#990000>=</font><font color=#FF0000>" +
                        firstRecord + "</font><font color=#FF0000>'&gt;Add to Cart&lt;/a&gt;");
            out.println("&lt;/td&gt;");
            out.println("&lt;/tr&gt;&lt;/table&gt;");
            out.println("&lt;hr class='</font>sepBar<font color=#FF0000>'/&gt;");            
            recordCount++;
          }
          // now for the &lt;&lt; and &gt;&gt; for moving through the ResultSet
          out.println("&lt;p align='</font>center<font color=#FF0000>'&gt;");
          // should we do a left arrow ?
          if (firstRecord&gt;0) {
            out.println("&lt;a href='</font>index<font color=#990000>.</font>jsp<font color=#990000>?</font>lastQuery<font color=#990000>=</font><font color=#FF0000>" + URLEncoder.encode(lastQuery) +
                        "</font><font color=#990000>&amp;</font>firstRecord<font color=#990000>=</font><font color=#FF0000>" + (firstRecord-MAX_RECORDS)  + "</font><font color=#FF0000>'&gt;[&amp;lt;&amp;lt;prev "+
                        MAX_RECORDS + " books]&lt;/a&gt;");
          }
          // should we do a right arrow ?, and how many for &gt;&gt;
          int leftOverRecords = 0;
          while (rs.next()) leftOverRecords++;
          if (leftOverRecords&gt;0) {
            out.println("&lt;a href='</font>index<font color=#990000>.</font>jsp<font color=#990000>?</font>lastQuery<font color=#990000>=</font><font color=#FF0000>" + URLEncoder.encode(lastQuery) +
                        "</font><font color=#990000>&amp;</font>firstRecord<font color=#990000>=</font><font color=#FF0000>" + (firstRecord+MAX_RECORDS) + "</font><font color=#FF0000>'&gt;[next " +
                        leftOverRecords + " books&amp;gt;&amp;gt;]&lt;/a&gt;");
          }
        } catch (SQLException e) {
          out.println("error");                      
        }                      

        if (recordCount==0) out.println("Your search returned 0 books.");
        out.println("&lt;/p&gt;");
        
      %&gt;
    
    &lt;/td&gt;

    &lt;!-- the search/category cell at the right --&gt;
    &lt;td width="200" valign="top"&gt;

      &lt;!-- the search box --&gt;
      &lt;form name="search" method="post" action="index.jsp"
       onsubmit="return validateSearch();"&gt;
      &lt;table class="outlineTable" width="100%"&gt;
        &lt;tr&gt;
          &lt;td class="outlineCell"&gt;
            &lt;table class="innerTable"&gt;
              &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Search for:&lt;/strong&gt;&lt;/td&gt;&lt;/tr&gt;
              &lt;tr&gt;&lt;td class="outlineCell"&gt;&lt;/td&gt;&lt;/tr&gt;
              &lt;tr&gt;
                &lt;td&gt;&lt;input type="text" name="searchFor" style="width:140pt"/&gt;&lt;/td&gt;
              &lt;/tr&gt;
              &lt;tr&gt;
                &lt;td align="center"&gt;
                  &lt;input type="radio" name="searchWhat" value="title" checked&gt;Title
                  &lt;/input&gt;
                  &lt;input type="radio" name="searchWhat" value="author_last"&gt;Author&lt;/input&gt;
                  &lt;input type="radio" name="searchWhat" value="isbn"&gt;ISBN&lt;/input&gt;
                &lt;/td&gt;
              &lt;tr&gt;
                &lt;td&gt;
                  &lt;select name="searchCategory" style="width:140pt"&gt;
                    &lt;option value="all"&gt;all categories&lt;/option&gt;                  
                    &lt;%
                      try {
                        Statement st = conn.createStatement();
                        ResultSet rs = st.executeQuery("SELECT category " +
                                                       "FROM category " +
                                                       "ORDER BY category");
                        while (rs.next()) {
                          out.println("&lt;option value='</font><font color=#FF0000>" + rs.getString("</font>category<font color=#FF0000>") + "</font><font color=#FF0000>'&gt;"+
                                      rs.getString("category") + "&lt;/option&gt;");
                        }
                      } catch (SQLException e) {
                        out.println("&lt;option&gt;error&lt;/option&gt;");                      
                      }                      
                    %&gt;
                  &lt;/select&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              &lt;tr&gt;
                &lt;td align="right"&gt;&lt;a href="advSearch.jsp"&gt;advanced&lt;/a&gt; 
                &lt;input type="submit" name="search" value="search"/&gt;&lt;/td&gt;
              &lt;/tr&gt;
            &lt;/table&gt;
          &lt;/td&gt;
        &lt;/tr&gt;      
      &lt;/table&gt;
      &lt;!-- 
        for some reason hitting enter in the search box doesn'</font>t send the value of the
        submit button as the other forms<font color=#990000>.</font><font color=#990000>.</font><font color=#990000>.</font>login <b><font color=#0000FF>for</font></b> example on <b><font color=#0000FF>this</font></b> page<font color=#990000>.</font><font color=#990000>.</font><font color=#990000>.</font> <b><font color=#0000FF>this</font></b> hack
        makes sure it gets that value
      <font color=#990000>-</font><font color=#990000>-</font><font color=#990000>&gt;</font>                            
      <font color=#990000>&lt;</font>input type<font color=#990000>=</font><font color=#FF0000>"hidden"</font> value<font color=#990000>=</font><font color=#FF0000>"search"</font> name<font color=#990000>=</font><font color=#FF0000>"search"</font><font color=#990000>/</font><font color=#990000>&gt;</font>
      <font color=#990000>&lt;</font><font color=#990000>/</font>form<font color=#990000>&gt;</font>
      <font color=#990000>&lt;</font>p<font color=#990000>&gt;</font>

      <font color=#990000>&lt;</font><font color=#990000>!</font><font color=#990000>-</font><font color=#990000>-</font> now the cateogory list <font color=#990000>-</font><font color=#990000>-</font><font color=#990000>&gt;</font>
      <font color=#990000>&lt;</font>table <b><font color=#0000FF>class</font></b><font color=#990000>=</font><font color=#FF0000>"outlineTable"</font> width<font color=#990000>=</font><font color=#FF0000>"100%"</font><font color=#990000>&gt;</font>
        <font color=#990000>&lt;</font>tr<font color=#990000>&gt;</font>
          <font color=#990000>&lt;</font>td <b><font color=#0000FF>class</font></b><font color=#990000>=</font><font color=#FF0000>"outlineCell"</font><font color=#990000>&gt;</font>
            <font color=#990000>&lt;</font>table <b><font color=#0000FF>class</font></b><font color=#990000>=</font><font color=#FF0000>"innerTable"</font><font color=#990000>&gt;</font>
              <font color=#990000>&lt;</font>tr<font color=#990000>&gt;</font><font color=#990000>&lt;</font>td<font color=#990000>&gt;</font><font color=#990000>&lt;</font>strong<font color=#990000>&gt;</font>Browse Categories<font color=#990000>:</font><font color=#990000>&lt;</font><font color=#990000>/</font>strong<font color=#990000>&gt;</font><font color=#990000>&lt;</font><font color=#990000>/</font>td<font color=#990000>&gt;</font><font color=#990000>&lt;</font><font color=#990000>/</font>tr<font color=#990000>&gt;</font>
              <font color=#990000>&lt;</font>tr<font color=#990000>&gt;</font><font color=#990000>&lt;</font>td <b><font color=#0000FF>class</font></b><font color=#990000>=</font><font color=#FF0000>"outlineCell"</font><font color=#990000>&gt;</font><font color=#990000>&lt;</font><font color=#990000>/</font>td<font color=#990000>&gt;</font><font color=#990000>&lt;</font><font color=#990000>/</font>tr<font color=#990000>&gt;</font>
              <font color=#990000>&lt;</font>tr<font color=#990000>&gt;</font><font color=#990000>&lt;</font>td<font color=#990000>&gt;</font>
                <font color=#990000>&lt;</font><font color=#990000>%</font>
                  <b><font color=#0000FF>try</font></b> <font color=#FF0000>{</font>
                    Statement st <font color=#990000>=</font> conn<font color=#990000>.</font><b><font color=#000000>createStatement</font></b><font color=#990000>(</font><font color=#990000>)</font><font color=#990000>;</font>
                    ResultSet rs <font color=#990000>=</font> st<font color=#990000>.</font><b><font color=#000000>executeQuery</font></b><font color=#990000>(</font><font color=#FF0000>"SELECT category "</font> <font color=#990000>+</font>
                                                   <font color=#FF0000>"FROM category "</font> <font color=#990000>+</font>
                                                   <font color=#FF0000>"ORDER BY category"</font><font color=#990000>)</font><font color=#990000>;</font>
                    <b><font color=#0000FF>while</font></b> <font color=#990000>(</font>rs<font color=#990000>.</font><b><font color=#000000>next</font></b><font color=#990000>(</font><font color=#990000>)</font><font color=#990000>)</font> <font color=#FF0000>{</font>
                      out<font color=#990000>.</font><b><font color=#000000>println</font></b><font color=#990000>(</font><font color=#FF0000>"&lt;a href='index.jsp?category="</font> <font color=#990000>+</font>
                                  rs<font color=#990000>.</font><b><font color=#000000>getString</font></b><font color=#990000>(</font><font color=#FF0000>"category"</font><font color=#990000>)</font> <font color=#990000>+</font> <font color=#FF0000>"'&gt;"</font> <font color=#990000>+</font>
                                  rs<font color=#990000>.</font><b><font color=#000000>getString</font></b><font color=#990000>(</font><font color=#FF0000>"category"</font><font color=#990000>)</font> <font color=#990000>+</font> <font color=#FF0000>"&lt;br/&gt;"</font><font color=#990000>)</font><font color=#990000>;</font>
                    <font color=#FF0000>}</font>
                  <font color=#FF0000>}</font> <b><font color=#0000FF>catch</font></b> <font color=#990000>(</font>SQLException e<font color=#990000>)</font> <font color=#FF0000>{</font>
                    out<font color=#990000>.</font><b><font color=#000000>println</font></b><font color=#990000>(</font><font color=#FF0000>"error"</font><font color=#990000>)</font><font color=#990000>;</font>                      
                  <font color=#FF0000>}</font>                      
                <font color=#990000>%</font><font color=#990000>&gt;</font>
              <font color=#990000>&lt;</font><font color=#990000>/</font>tr<font color=#990000>&gt;</font>
            <font color=#990000>&lt;</font><font color=#990000>/</font>table<font color=#990000>&gt;</font>
          <font color=#990000>&lt;</font><font color=#990000>/</font>td<font color=#990000>&gt;</font>
        <font color=#990000>&lt;</font><font color=#990000>/</font>tr<font color=#990000>&gt;</font>      
      <font color=#990000>&lt;</font><font color=#990000>/</font>table<font color=#990000>&gt;</font>
    <font color=#990000>&lt;</font><font color=#990000>/</font>td<font color=#990000>&gt;</font>

  <font color=#990000>&lt;</font><font color=#990000>/</font>tr<font color=#990000>&gt;</font>
<font color=#990000>&lt;</font><font color=#990000>/</font>table<font color=#990000>&gt;</font>

<font color=#990000>&lt;</font><font color=#990000>/</font>body<font color=#990000>&gt;</font>
<font color=#990000>&lt;</font><font color=#990000>/</font>html<font color=#990000>&gt;</font></tt>
</pre>
</body>
</html>
