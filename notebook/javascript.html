<!--
Content-type: Preventing XSRF in IE.

-->
<html><head><link type="text/css" rel="stylesheet" href="/notebook/resources/1553808490-public_css.css">
<title>javascript</title></head>
<body bgcolor="#FFFFFF" onload=""><link type="text/css" rel="stylesheet" href="/notebook/resources/3158938506-staticpages_css.css">
<table align="center" border="0" cellpadding="5" cellspacing="0" width="100%"><tr valign="middle"><td width="1%"><a href="/notebook/"><img src="/notebook/images/en_notebook_150x55.png" align="left" border="0" height="55" width="150" alt="Google Notebook"></a></td>
<td><table style="margin-bottom: 5px;" align="center" bgcolor="#c3d9ff" border="0" cellpadding="0" cellspacing="0" width="100%" dir="ltr"><tr><td class="bubble tl" align="left" valign="top"><img src="/notebook/images/corner_tl.gif" class="c" alt=""></td>
<td class="bubble1" rowspan="2" style="padding: 3px 0pt; font-family: arial; text-align: left; font-weight: bold; font-size: 100%;">javascript</td>
<td class="bubble tr" align="right" valign="top"><img src="/notebook/images/corner_tr.gif" class="c" alt=""></td></tr>
<tr><td class="bubble bl" align="left" valign="bottom"><img src="/notebook/images/corner_bl.gif" class="c" alt=""></td>
<td class="bubble br" align="right" valign="bottom"><img src="/notebook/images/corner_br.gif" class="c" alt=""></td></tr></table></td></tr></table>
<br>
<div id="pubContent"><div id="pubHeader"><div id="pubHeaderSub">Last edited  March 29, 2007 
<br></div></div>

<a name="NDRnEDAoQ0-PgsNsj"></a>
<div class="PubNote">
<div class="PubNoteContentArea">Example of select only of related model with prototype / scriptaculous autocomplete.  Note that the &lt;li&gt; are returned with spans of name and id, where the id is shuttled into a hidden field and the name is placed in the control.  The add button is only enabled if they have selected an actual related record:<br><br>  &lt;tr&gt;<br>    &lt;td&gt;Instructors:&lt;/td&gt;<br>    &lt;td&gt;<br>      &lt;%= text_field_tag &#39;instructor&#39;, &#39;&#39;, :autocomplete =&gt; &#39;off&#39; %&gt;<br>      &lt;div id=&quot;instructor_auto_complete&quot; class=&quot;auto_complete&quot;&gt;&lt;/div&gt;<br>      &lt;%= hidden_field_tag &#39;instructor_id&#39; %&gt;<br>      &lt;input type=&quot;button&quot; value=&quot;Add&quot; id=&quot;add_instructor&quot; disabled=&quot;disabled&quot;/&gt;<br>    &lt;/td&gt;<br>  &lt;/tr&gt;<br>  &lt;tr&gt;<br>    &lt;td&gt;&lt;/td&gt;<br>    &lt;td&gt;<br>      &lt;ul id=&quot;instructors&quot; class=&quot;naked&quot;&gt;<br>          &lt;% @edu_class.instructors.each do |instructor| -%&gt;<br>              &lt;li&gt;<br>                  &lt;%= <a href="http://instructor.name">instructor.name</a> %&gt;&lt;%= hidden_field_tag &#39;edu_class[instructor_attributes][][id]&#39;, <a href="http://instructor.id">instructor.id</a> %&gt;<br>                  &lt;a href=&quot;#&quot;&gt;remove&lt;/a&gt;<br>              &lt;/li&gt;<br>          &lt;% end -%&gt;<br>      &lt;/ul&gt;<br>    &lt;/td&gt;<br>  &lt;/tr&gt;<br>&lt;/table&gt;<br>&lt;script&gt;<br>// this is not the latest prototype so some of the niceties are not here...<br>var instructorAutoCompleter = new Ajax.Autocompleter(&quot;instructor&quot;,<br>    &quot;instructor_auto_complete&quot;, &quot;/edu_classes/possible_instructors&quot;,<br>    {updateElement: function(li) {storeSelection(li);}});<br><br>function class2Content(className, element) {<br>  element = $(element || document);<br>  return element.getElementsByClassName(className).reduce().innerHTML;<br>}<br><br>// ack no evt.stop() in prototype 1.5<br>function stop(event) {<br>  if (event.preventDefault) {<br>    event.stopPropagation();<br>    event.preventDefault();<br>  } else {<br>    event.returnValue = false;<br>    event.cancelBubble = true;<br>  }<br>}<br><br>function storeSelection(li) {<br>  var instructor = class2Content(&quot;name&quot;, li);<br>  var id = class2Content(&quot;id&quot;, li);<br>  $(&quot;instructor&quot;).value = instructor;<br>  $(&quot;instructor_id&quot;).value = id;<br>  $(&quot;add_instructor&quot;).enable();<br>}<br><br>function addInstructor() {<br>  var str = &#39;&lt;li&gt;#{name}&#39;;<br>  str += &#39;&lt;input type=&quot;hidden&quot; name=&quot;edu_class[instructor_attributes][][id]&quot; value=&quot;#{id}&quot;/&gt;&#39;;<br>  str += &#39; &lt;a href=&quot;#&quot;&gt;remove&lt;/a&gt;&#39;<br>  str += &#39;&lt;/li&gt;&#39;;<br>  var template = new Template(str);<br>  var fields = {name: $F(&quot;instructor&quot;), id: $F(&quot;instructor_id&quot;)};<br>  new Insertion.Bottom(&quot;instructors&quot;, template.evaluate(fields));<br>}<br><br>$(&quot;add_instructor&quot;).observe(&quot;click&quot;, function(evt) {<br>  $(&quot;add_instructor&quot;).disable();<br>  addInstructor();<br>  $(&quot;instructor&quot;).value = &quot;&quot;;<br>});<br><br>$(&quot;instructor&quot;).observe(&quot;keydown&quot;, function(evt) {<br>  // disable the add button for anything that may have changed the text<br>  var keyCode = evt.keyCode;<br>  if (keyCode != Event.KEY_DOWN &amp;&amp; keyCode != Event.KEY_END<br>      &amp;&amp; keyCode != Event.KEY_ESC &amp;&amp; keyCode != Event.KEY_HOME<br>      &amp;&amp; keyCode != Event.KEY_INSERT &amp;&amp; keyCode != Event.KEY_LEFT<br>      &amp;&amp; keyCode != Event.KEY_PAGEDOWN &amp;&amp; keyCode != Event.KEY_PAGEUP<br>      &amp;&amp; keyCode != Event.KEY_RETURN &amp;&amp; keyCode != Event.KEY_RIGHT<br>      &amp;&amp; keyCode != Event.KEY_TAB &amp;&amp; keyCode != Event.KEY_UP) {<br>    $(&quot;add_instructor&quot;).disable();<br>  }<br>  if (keyCode == Event.KEY_RETURN) stop(evt);<br>});<br><br>$(&quot;instructors&quot;).observe(&quot;click&quot;, function(evt) {<br>  // ack, no evt.element() in prototype 1.5<br>  var target = Event.element(evt);<br>  if (target.tagName == &quot;A&quot;) target.up(&quot;li&quot;).remove();<br>});<br>&lt;/script&gt;<br> </div>
</div> <a name="NDR2TIgoQvuvCusgj"></a>
<div class="PubNote">
<div class="PubNoteContentArea">document.documentElement and document.documentElement.firstChild <br></div>
</div> <a name="NDSGpIgoQh4qU3q4j"></a>
<div class="PubNote">
<div class="PubNoteContentArea">Some trim regular expressions.<br><br>s.replace(/^\s*|\s*$/g, &quot;&quot;) <br><br>or another<br><br>s.replace(/^\s*(\S.*?)\s*$/, &quot;$1&quot;)<br></div>
</div> <a name="NDSS8IgoQjY3dhZoi"></a>
<div class="PubNote">
<div class="PubNoteContentArea"><font face="arial,sans-serif">Function to collect everything in a document with a specific class.  Obviously functions that collect things in a document, and not under
just a specific node, need not be written with a recursive function. 
That is they can just grab all the elements in the document and then
iterate through them.  Note the usage of the || to use a FF or old IE
style fetch of all the elements in the document:<br><br><font face="courier new,monospace">     document.getElementsByClassName = function(className) {<br>       var children = document.getElementsByTagName(&#39;*&#39;) || document.all;<br>       var elements = new Array();<br><br>       for (var i = 0; i &lt; children.length; i++) {<br>         var child = children[i];<br>         var classNames = child.className.split(&#39; &#39;);<br>         for (var j = 0; j &lt; classNames.length; j++) {<br>           if (classNames[j] == className) {<br>             elements.push(child);<br>             break;<br>           }<br>         }<br>       }<br><br>       return elements;<br>     }<br></font></font></div>
</div> <a name="NDQGkIwoQpMis07gi"></a>
<div class="PubNote">
<div class="PubNoteContentArea"><font face="arial,sans-serif" size="2">David Flanagan&#39;s javascript book has a nice Cookie class in it that makes reading and writing cookies rather painless, however, I found a bug in it that manifests itself in Firefox.  Because Firefox puts a space after the separating semicolons in the cookie string the cookie lookup code will not work.  This can be fixed by changing this line:</font><font size="2"><font face="arial,sans-serif"><br><br></font></font>var cookies = allcookies.split(&#39;;&#39;);<pre><font face="arial,sans-serif" size="2"><font size="2">with this:<br><br>var cookies = allcookies.replace(/ /g, &#39;&#39;).split(&#39;;&#39;);<br><br>That is globally replace the space with an empty string before the split.</font><br></font></pre></div>
</div> <a name="NDQzjIgoQyvX-5Nci"></a>
<div class="PubNote">
<div class="PubNoteContentArea"> Internet Explorer (6.0 anyway) won&#39;t let you set the innerHTML of a
select element in order to change the options therein contained. 
Instead you need to zero the options out and then loop to add new
options.  This might look like so:<br>
<br>
select.options.length = 0;<br>
for (var i = 0; i &lt; data.length; i++) {<br>
  // Option(text, value, defaultSelected, selected)<br>
  select.options[i] = new Option(<a href="http://data.name">data.name</a>, <a href="http://data.id">data.id</a>, false, false);<br>
}<br><br>With that said prototype does have an update method that I did not try, it may in fact have some kind of work around by which it will let  you set the content of the select with a string containing &lt;option&gt;....&lt;/option&gt;....  That would look something like this:<br><br>$(&#39;theSelect&#39;).update(returnedContent);<br></div>
</div> <a name="NDQXAIwoQquq_r9oi"></a>
<div class="PubNote">
<div class="PubNoteContentArea"> For internet exploder, you must return false from an onclick that actually should refresh the page such as when it submits a form through a form.submit call.  Example:<br><br>&lt;a href=&quot;javascript:void(0);&quot; onclick=&quot;&lt;%= &quot;var e = $(&#39;evacuation_injury&#39;); e.value = #{(@evacuation.injury) ? 0 : 1}; $(&#39;switch&#39;).value = &#39;yes&#39;; var f = $(e.form); f.enable(); f.submit(); return false;&quot; %&gt;&quot;&gt;click me&lt;/a&gt;<br><br>Otherwise you don&#39;t get a page reload.<br></div>
</div> <a name="NDRCcIwoQns7R0N0i"></a>
<div class="PubNote">
<div class="PubNoteContentArea">This is some crazy javascript that stores a large amount of data across several cookies.  Kind of useless, because its just too much data for cookies, but still shows some interesting techniques on splitting and rejoining the data:<br><br> function storeTreeState() {<br>    // TODO: really need to delete old cookies<br>    var state = rootNode.getTreeState();<br>    console.log(&quot;storeTreeState() = &quot; + state);<br>    var numCookies = neededCookies(state);<br>    for (var i = 0; i &lt; numCookies; i++) {<br>        var cookieName = &quot;treeview&quot; + i;<br>        var cookie = new Cookie(cookieName);<br>        var offset = i * 2048;<br>        cookie.state = state.substr(offset, Math.min(2048, state.length - offset));<br>        if (i == 0) cookie.num = numCookies;<br>        cookie.store();<br>    }<br><br>}<br><br>function readTreeState() {<br>    var cookie = new Cookie(&quot;treeview0&quot;);<br>    var numCookies = cookie.num;<br>    if (numCookies == undefined) return null;<br>    var state = cookie.state;<br>    for (i = 1; i &lt; numCookies; i++) {<br>        var cookie = new Cookie(&quot;treeview&quot; + i);<br>        state += cookie.state;<br>    }<br>    console.log(&quot;readTreeState() = &quot; + state);<br>    return state;<br>}<br><br>function neededCookies(value) {<br>  var length = value.length;<br>  var fullCookies = Math.floor(length / 2048);<br>  var partialCookies = ((length % 2048) &gt; 0) ? 1 : 0;<br>  return fullCookies + partialCookies;<br>}<br><br>function initTreeFromState(state) {<br>    var root = eval(&quot;(&quot; + state + &quot;)&quot;);<br>    rootNode = new Node(new Tree(&quot;tree&quot;), <a href="http://root.id">root.id</a>, root.root, root.view,<br>        <a href="http://root.name">root.name</a>, root.expandable, root.loaded, root.expanded);<br>    rootNode.render();<br>    rootNode.load(root.children);<br>}</div>
</div> <a name="NDSfhIgoQ3qa85uAi"></a>
<div class="PubNote">
<div class="PubNoteContentArea">Prototypes up call is kind of cool for wiping out form elements, such as on a remove subcomponent type operation.  You might use it in rails like this:<br><br>&lt;%= link_to_function &#39;X&#39;, &#39;$(&quot;this&quot;).up(&quot;div&quot;).remove()&#39; %&gt;<br><br></div>
</div></div></body></html>